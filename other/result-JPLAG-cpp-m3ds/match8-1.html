<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>M3DS (4).cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>M3DS (4).cpp</CENTER></H3><HR>
<PRE>

ESign FaceBSP::sign(const Vector3 &amp;p) const {
<A NAME="0"></A>
  ESign res=SIGN_NONE;

<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match8-0.html#0',2,'match8-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>  Vector3 point = _tabVertex[0]-&gt;point();
  if(Vector3(point,p).dot(_normal) &gt;= 0)
      res = SIGN_PLUS;
  else res = SIGN_MINUS;

  return res;
}


Vector3 FaceBSP::intersection(const Vector3 &amp;p1,const Vector3 &amp;p2) const {</B></FONT>

  Vector3 res;

  Vector3 seg(p1,p2);
 
  if (seg.dot(_normal) &lt; 0.001 &amp;&amp; seg.dot(_normal) &gt; -0.001) return p1;
  double k = ((point(0)-p1).dot(_normal)) / (seg.dot(_normal));
  res = p1 + k * seg;

  return res;
}



void FaceBSP::separe(const FaceBSP &amp;f) {

  Vector3 last = this-&gt;point(_tabVertex.size()-1);
  int lastIndex = _tabVertex.size()-1;

  for(int i = 0; i&lt;_tabVertex.size(); i++)
  {
    if(f.sign(this-&gt;point(i)) != f.sign(last)){
      VertexBSP *inter = createVertex(f.intersection(this-&gt;point(i),last));
      inter-&gt;interpolateNormal(*_tabVertex[i], *_tabVertex[lastIndex]);
      vertexNegative.push_back(inter);
      vertexPositive.push_back(inter);
    }

    last = this-&gt;point(i);
    lastIndex = i;

    if(f.sign(this-&gt;point(i)) == SIGN_PLUS)
        vertexPositive.push_back(_tabVertex[i]);
    else vertexNegative.push_back(_tabVertex[i]);
  }

}
</PRE>
</BODY>
</HTML>
