<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>M3DS (2).cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>M3DS (2).cpp</CENTER></H3><HR>
<PRE>
ESign FaceBSP::sign(const Vector3 &amp;p) const {
    ESign res=SIGN_NONE;

    Vector3 newP = Vector3(_tabVertex[0]-&gt;point(), p);
    Vector3 normalFace = this-&gt;_normal;
    double scalaire = normalFace.dot(newP);
    if(_tabVertex.size()&gt;0){
<A NAME="0"></A>        if(scalaire &lt; 0.)
            res = SIGN_MINUS;
        else
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match14-0.html#0',2,'match14-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>            res = SIGN_PLUS;
    }

    return res;
}



Vector3 FaceBSP::intersection(const Vector3 &amp;p1,const Vector3 &amp;p2) const {
    Vector3 res;


    Vector3 p1p2(p1,p2);

   
    double p1p1ScalN = p1p2.dot(_normal);
    if (fabs(p1p1ScalN) &lt; 0.01 )
        return Vector3((p1.x()+p2.x())/2,(p1.y()+p2.y())/2,(p1.z()+p2.z())/2);

    double k = (point(0).dot(_normal) - p1.dot(_normal)) / p1p1ScalN;</B></FONT>

    if ( fabs(k) &lt; 0.01)
        return p1;
    res = p1 + k * p1p2;


    return res;
}


void FaceBSP::separe(const FaceBSP &amp;f) {
    
    bool estPositif;
    VertexBSP *tmp = _tabVertex[0], *anc;
    ESign sign = f.sign(tmp-&gt;point());
    if(sign == SIGN_MINUS){
        vertexNegative.push_back(tmp);
    } else if(sign == SIGN_PLUS){
        vertexPositive.push_back(tmp);
    }

    for(int i = 1; i&lt;_tabVertex.size(); i++){
        anc = tmp;
        tmp = _tabVertex[i];
        sign = f.sign(tmp-&gt;point());
        if(sign != SIGN_NONE){
            if(f.sign(anc-&gt;point()) != sign){
                VertexBSP *inter=createVertex(f.intersection(_tabVertex[i-1]-&gt;point(),tmp-&gt;point()));
                inter-&gt;interpolateNormal(*_tabVertex[i-1],*tmp);
                vertexNegative.push_back(inter);
                vertexPositive.push_back(inter);
            }
        }
        if(sign == SIGN_MINUS){
            vertexNegative.push_back(tmp);
        } else if(sign == SIGN_PLUS){
            vertexPositive.push_back(tmp);
        }
    }
    anc = tmp;
    tmp = _tabVertex[0];

    sign = f.sign(tmp-&gt;point());
    if(f.sign(anc-&gt;point()) != sign){
        VertexBSP *inter=createVertex(f.intersection(_tabVertex[_tabVertex.size()-1]-&gt;point(),tmp-&gt;point()));
        inter-&gt;interpolateNormal(*_tabVertex[_tabVertex.size()-1],*tmp);
        vertexNegative.push_back(inter);
        vertexPositive.push_back(inter);
    }
}



</PRE>
</BODY>
</HTML>
